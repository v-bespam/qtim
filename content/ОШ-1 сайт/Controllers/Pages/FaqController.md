---
date: 2024-09-30
tags:
  - qtim
---
Контроллер предназначен для получения страниц раздела вопросы и ответы

### Endpoints

Контроллер предоставляет следующий эндпоинт:

| Метод | URL             | Описание                                                                      |
| ----- | --------------- | ----------------------------------------------------------------------------- |
| GET   | `nest/api/faq/` | [[#Получение страницы вопросы и ответы\|Получение страницы вопросы и ответы]] |

### Получение страницы вопросы и ответы

`GET nest/api/faq/`

*Входные данные:*

- Query параметры:

| Параметр | Тип данных | Валидация    | Описание            |
| -------- | ---------- | ------------ | ------------------- |
| code     | string     | Опциональный | Код группы вопросов |

Выполняет поиск в кэше Redis по ключу `faq-page:${code}`, если данные не найдены, подготавливает их:

1. Выполняет запрос к Strapi для получения страницы FAQCommonData (API ID: faq-common-data)
2. Выполняет поиск в Redis информации о группах вопросов по ключу `faq-groups`. Если данные отсутствуют, запрашивает в Strapi элементы коллекции FAQGroups (API ID: faq-group) с сортировкой по возрастанию и сохраняет в кэш Redis.
3. Информацию о группах преобразует в новый массив, содержащий только свойства `title` и `code`
4. Если был указан код группы:
	1. Выполняет его поиск в массиве. В случае, если группа вопросов с таким кодом отсутствует выбрасывает исключение NotFoundException с сообщением об ошибке: "Page not found"
	2. Формирует хлебные крошки для указанной группы и обновляет метаданные страницы, если они доступны

Заправшивает
страницу Strapi: FAQCommonData API ID: faq-common-data
коллекцию Strapi: FAQGroups

Возвращает объект с информацией о странице и хлебных крошках