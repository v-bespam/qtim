---
date: 2024-09-30
tags:
  - ОШ-1-сайт
---
Контроллер предназначен для работы с формами на сайте.

### Endpoints

Контроллер предоставляет следующие эндпоинты:

| Метод | URL                                    | Описание                                                |
| ----- | -------------------------------------- | ------------------------------------------------------- |
| POST  | `nest/api/forms/request/`              | [[#Оставить заявку на сайте\|Оставить заявку на сайте]] |
| POST  | `nest/api/forms/remark/`               |                                                         |
| POST  | `nest/api/forms/buy/`                  |                                                         |
| POST  | `nest/api/forms/course-review/`        |                                                         |
| POST  | `nest/api/forms/respond-to-vacancy/`   |                                                         |
| POST  | `nest/api/forms/recommend-to-vacancy/` |                                                         |

### Сохранение в Strapi данных формы заявки на сайте

`POST nest/api/forms/request/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                                           |
| -------- | ---------- | ------------ | -------------------------------------------------- |
| leadName | string     | Опциональный | Название формы на сайте                            |
| name     | string     | Обязательный | Имя                                                |
| phone    | string     | Обязательный | Номер телефона                                     |
| email    | string     | Опциональный | Адрес электронной почты                            |
| company  | string     | Опциональный | Организация                                        |
| question | string     | Опциональный | Вопрос                                             |
| referer  | string     | Обязательный | Ссылка на страницу, с которой был оставлена заявка |

*Функционал:*

Отправляет в коллекцию Strapi FormRequests (API ID: form-request) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi данных формы обратной связи на сайте

`POST nest/api/forms/remark/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                |
| -------- | ---------- | ------------ | ----------------------- |
| name     | string     | Обязательный | Имя                     |
| phone    | string     | Обязательный | Номер телефона          |
| email    | string     | Обязательный | Адрес электронной почты |
| text     | string     | Обязательный | Текст сообщения         |

*Функционал:*

Отправляет в коллекцию Strapi FormRemarks (API ID : form-remarks) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi данных формы записи на курс на сайте

`POST nest/api/forms/buy/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр | Тип данных | Валидация    | Описание                |
| -------- | ---------- | ------------ | ----------------------- |
| leadName | string     | Опциональный | Название формы на сайте |
| name     | string     | Обязательный | Имя                     |
| phone    | string     | Обязательный | Номер телефона          |
| email    | string     | Опциональный | Адрес электронной почты |
| company  | string     | Опциональный | Организация             |
| question | string     | Опциональный | Вопрос                  |
| course   | number     | Обязательный | ID курса                |

*Функционал:*

Отправляет в коллекцию Strapi BuyRequests (API ID : buy-request) данные формы на сайте, переданные в запросе.

*Выходные данные:* Status: `201 Created`

### Сохранение в Strapi нового отзыва на курс

`POST nest/api/forms/course-review/`

*Входные данные:*

- В тело запроса должны быть переданы следующие параметры:

| Параметр      | Тип данных | Валидация    | Описание         |
| ------------- | ---------- | ------------ | ---------------- |
| name          | string     | Обязательный | Имя              |
| text          | string     | Обязательный | Текст отзыва     |
| starsCount    | number     | Обязательный | Количество звезд |
| course_review | number     | Опциональный | ???              |
| course        | number     | Опциональный | ID курса         |

*Функционал:*

При помощи RequestPayload получает `fingerprint.hash` пользователя и проверяет имеет ли он право оставлять отзывы. Для нового отзыва устанавливает значения свойства `published_at: null` чтобы в Strapi его статус был установлен как "Черновик".

Отправляет в коллекцию Strapi CourseReviews (API ID : course-review) данные формы на сайте, переданные в запросе. В случае, если в запросе был передано изображение, создает поток чтения из файла и передает его с оригинальным названием. Максимальный объем файла 10 Мб

*Выходные данные:* Status: `201 Created`

### Откликнуться на вакансию - ЗАКОНЧИЛ ЗДЕСЬ

`POST nest/api/forms/respond-to-vacancy/`

Отправляет в Strapi отклик на вакансию

В запросе может быть передано изображение. Максимальный объем 10 Мб
В тело запроса должны быть переданы параметры:

- name: string;
- surname: string;
- phone: string;
- email: string;
- vacancy?: number;
- subject?: number;
- resumeLink?: string;
- aboutMe?: string;

В случае успеха возвращает 201 Created

Коллекция Strapi: VacancyRequests, API ID: vacancy-request

### Рекомендация на вакансию

`POST nest/api/forms/recommend-to-vacancy/`

Отправляет в Strapi рекомендацию на вакансию

В запросе может быть передано изображение. Максимальный объем 10 Мб
В тело запроса должны быть переданы параметры:

- name: string;
- surname: string;
- phone: string;
- vacancy: number; - должность
- resumeLink?: string;
- sourceUserName: string; - кто отправил
- sourceUserSurname: string;
- sourceUserEmail: string;
- sourceUserPhone: string;
- sourceUserIsEmployee: string;

В случае успеха возвращает 201 Created

Коллекция Strapi: HrRecommendFormRequests, API ID: hr-recommend-form-request